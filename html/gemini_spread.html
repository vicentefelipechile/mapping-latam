<head>
    <style>
        body {
            background-color: rgb(2, 41, 51);
            margin: 0;
            overflow: hidden;
        }

        .gemini-container {
            /* Display */
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            align-content: center;
            align-items: center;
            justify-content: center;

            /* Size */
            width: 100%;
            height: 100%;
        }

        .gemini-square {
            width: 12px;
            height: 12px;
            border-radius: 3px;
            background-color: white;
            margin: 2px;

            /* Fading effect to gemini square when changing color */
            transition: background-color 0.26s;
        }
    </style>
</head>
<body>
    <div class="gemini-container"></div>

    <script>
        const Range = (min, max) => Math.floor(Math.random() * (max - min + 1) + min)

        // Ranges
        let CustomPercentage = 10
        let Temperature = 0.5
        let TopK = 30
        let TopP = 0.5

        // Calculate the number of squares needed to fill the screen in width and height
        let width = Math.floor(window.innerWidth / 16)
        let height = Math.min( Math.floor(window.innerHeight / 18), 10)

        function GetTemperatureNumber() {
            // Range between Temperature and 1
            return Math.random() * (1 - Temperature) + Temperature
        }

        function GetTemperatureColor(Intensity) {
            // Select the color based on the intensity
            // Delta red between 10 and 60
            // Delta green between 100 and 140
            // Delta blue between 30 and 50
            let r = Math.floor(10 + Intensity * 20)
            let g = Math.floor(40 + Intensity * 30)
            let b = Math.floor(60 + Intensity * 50)

            return `rgb(${r}, ${g}, ${b})`
        }

        function GetTemperatureColor2(Intensity) { // This color is based on Temperature
            // Select the color based on the intensity
            // Delta red between 10 and 60
            // Delta green between 235 to 210 (starts at 235 and goes down)
            // Delta blue between 30 and 90
            let r = Math.floor(30 - Intensity * 20)
            let g = Math.floor(245 - Intensity * 25)
            let b = Math.floor(60 - Intensity * 30)

            return `rgb(${r}, ${g}, ${b})`
        }

        function GetTemperatureColor3(Intensity) { // This color is based on Top P
            let r = Math.floor(30 - Intensity * 20)
            let g = Math.floor(140 - Intensity * 50)
            let b = Math.floor(50 - Intensity * 30)

            return `rgb(${r}, ${g}, ${b})`
        }




        // Square functions
    
        function RandomizeColors() {
            let squares = document.querySelectorAll(".gemini-square")
            for (let i = 0; i < squares.length; i++) {
                let square = squares[i]
                square.style.backgroundColor = GetTemperatureColor(GetTemperatureNumber())
            }
        }

        function GenerateSquares() {
            // Clear the container
            const container = document.querySelector(".gemini-container")
            container.innerHTML = ""

            // Create the squares
            for (let i = 0; i < height; i++) {
                for (let j = 0; j < width; j++) {
                    let square = document.createElement("div")
                    square.classList.add("gemini-square")
                    container.appendChild(square)
                }
                let br = document.createElement("br")
                container.appendChild(br)
            }

            RandomizeColors()
        }


        function GenerateHighlight() {
            let Amount = Math.floor((width * height) * (TopK / 100) )
            let AmountNormal = Math.max( Math.floor(Amount * (1 - TopP)), 1)
            let AmountTopP = Amount - AmountNormal
            console.log(Amount, AmountTopP, AmountNormal)

            let squares = document.querySelectorAll(".gemini-square")
            let usedsquares = []
            for (let i = 0; i < AmountNormal; i++) {
                let square = squares[ Range(0, squares.length - 1) ]
                square.style.backgroundColor = GetTemperatureColor2(GetTemperatureNumber())

                usedsquares.push(square)
            }

            // remove the used squares
            squares = Array.from(squares).filter( (square) => !usedsquares.includes(square) )

            for (let i = 0; i < AmountTopP; i++) {
                let square = squares[ Range(0, squares.length - 1) ]
                square.style.backgroundColor = GetTemperatureColor3(GetTemperatureNumber())
            }
        }

        GenerateSquares()
        GenerateHighlight()

        function SetTemperature(V) {
            Temperature = parseFloat(V)
            RandomizeColors()
            GenerateHighlight()
        }

        function SetTopK(V) {
            TopK = parseInt(V)
            RandomizeColors()
            GenerateHighlight()
        }

        function SetTopP(V) {
            TopP = parseFloat(V)
            RandomizeColors()
            GenerateHighlight()
        }

        // Refresh on press R
        document.addEventListener("keydown", (event) => {
            if (event.key === "r") {
                RandomizeColors()
                GenerateHighlight()
            }
        })

        // on press D or right arrow, increase the highlight
        document.addEventListener("keydown", (event) => {
            if (event.key === "d" || event.key === "ArrowRight") {
                TopK += 5

                TopK = Math.min(TopK, 100)
                RandomizeColors()
                GenerateHighlight()
            }
        })

        // on press A or left arrow, decrease the highlight
        document.addEventListener("keydown", (event) => {
            if (event.key === "a" || event.key === "ArrowLeft") {
                TopK -= 5

                TopK = Math.max(TopK, 5)
                RandomizeColors()
                GenerateHighlight()
            }
        })

        // on press W or up arrow, increase the temperature
        document.addEventListener("keydown", (event) => {
            if (event.key === "w" || event.key === "ArrowUp") {
                Temperature += 0.1

                Temperature = Math.min(Temperature, 1)
                RandomizeColors()
                GenerateHighlight()
            }
        })

        // on press S or down arrow, decrease the temperature
        document.addEventListener("keydown", (event) => {
            if (event.key === "s" || event.key === "ArrowDown") {
                Temperature -= 0.1

                Temperature = Math.max(Temperature, 0)
                RandomizeColors()
                GenerateHighlight()
            }
        })

        // On change the page size, recalculate the squares
        window.addEventListener("resize", () => {
            width = Math.floor(window.innerWidth / 16)
            height = Math.min( Math.floor(window.innerHeight / 18), 10)
            GenerateSquares()
            GenerateHighlight()
        })

        // On press Z, decrease the Top P
        document.addEventListener("keydown", (event) => {
            if (event.key === "z") {
                TopP -= 0.1

                TopP = Math.max(TopP, 0)
                RandomizeColors()
                GenerateHighlight()
            }
        })

        // On press X, increase the Top P
        document.addEventListener("keydown", (event) => {
            if (event.key === "x") {
                TopP += 0.1

                TopP = Math.min(TopP, 1)
                RandomizeColors()
                GenerateHighlight()
            }
        })
    </script>
</body>